---
title: 浅谈 go 中的 ok 断言的使用
author: "edte"
categories: ["go"]
date: 2020-05-08
---



## 断言(assertion)

wiki是这么说的

>在[程式设计](https://zh.wikipedia.org/wiki/程式設計)中，**断言**（ **assertion** ）是一种放在程式中的[一阶逻辑](https://zh.wikipedia.org/wiki/一階邏輯)（如一个结果为真或是假的逻辑判断式）

换言之，断言（assertion） 就是一个逻辑判断表达式。



## 接口 （interface）

接口是 go 中的一种数据类型，使用 interface 关键字。接口是一种鸭子类型（duck typing）,是一组方法的集合。

如

```
type Animal interface {
}
```

没有成员方法，故是一个空接口

如

```
type Animal interface {
	Speak(msg string)
}
```

Animal 接口有一个 Speak() 成员方法，故是一个有方法的接口。

实现了接口的所有方法就是实现了这个接口。

如我们这里有一个 Animal 接口

```
type Animal interface {
	Speak(msg string)
}
```

然后有两个 struct

```
type cat struct {
}
type dog struct {
}
```

然后实现 Animal 接口，也就是给这两个 struct 分别添加  Animal 接口的方法

```
func (c cat) Speak(msg string) {
	fmt.Println("cat say:" + msg)
}

func (c dog) Speak(msg string) {
	fmt.Println("dog say:" + msg)
}
```

注意，要实现某个接口必须实现接口的所有方法，包括方法个数，函数签名（signature functions），同时也可以是其他 type ,如 int ，string 等，不一定是 struct

实现了接口就可以使用了，这里给个例子

```
type Animal interface {
	Speak(msg string)
}

type cat struct {
}
type dog struct {
}

func (c cat) Speak(msg string) {
	fmt.Println("cat say:" + msg)
}

func (c dog) Speak(msg string) {
	fmt.Println("dog say:" + msg)
}

func main() {
    // 声明一个 animal 变量
	var animal Animal
	// 把 cat{} 赋值给 animal，因为 cat struct 实现了 animal interface
	animal = cat{}
	animal.Speak("Hello,i'm cat")
	
	animal = dog{}
	animal.Speak("Hello,i'm dog")
}

```

我们可以看见，只要实现了某个接口，那么这个接口就可以转换为所有实现了这个接口的 type

空接口没有任何成员方法，所以所有类型都实现了空接口，也就是说，空接口可以转换为所有类型，所有类型也可以转换为空接口

为了实现这一点，我们先引入一下反射 （reflection）的概念

## 反射（reflection）

wiki

> 在[计算机学](https://zh.wikipedia.org/wiki/計算機學)中，**反射**（英语： **reflection** ）是指[计算机程序](https://zh.wikipedia.org/wiki/计算机程序)在[运行时](https://zh.wikipedia.org/wiki/运行时)（ runtime）可以访问、检测和修改它本身状态或行为的一种能力。[[1\]](https://zh.wikipedia.org/wiki/反射_(计算机科学)#cite_note-Forman_p8-1) 用比喻来说，反射就是程序在运行的时候能够 “观察” 并且修改自己的行为

换句话说，我们可以在操作某个对象时，运用反射来查看其具体类型，如看某个变量是不是 string 类型，struct 有哪些 filed 等

首先我们要知道所有变量都是于 Type 和 Value 组成的，如名字， Type 是变量类型，Value 是具体的值

如

```
var a int
```

这里我们用 var 关键字声明了一个 int 变量，那么其 Type 就是 int, Value 就是 nil

然后我们对其赋值

```
a = 1
```

Value 就变成 1 了

当然我们可以使用 := 语法糖声明变量的同时赋值

```
a := 1
```

这里会根据赋值的内容自动判断 Type, Type 就是 int, Value 就是 1 

自然的，reflect 包就给我们提供了两个函数用来判断它们的值

我们来开源码

```
func TypeOf(i interface{}) Type {
//
}

func ValueOf(i interface{}) Value {
//
}
```

