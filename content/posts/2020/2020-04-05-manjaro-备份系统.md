---
title: manjaro 备份系统
author: "edte"
tags: ["Linux"]
categories: ["备份系统"]
date: 2020-04-05

---



# 分析

manjaro 一共两个分区， boot 分区和 / 分区

无论是系统迁移或是单纯的系统备份。像 boot 分区这种和硬件有光的文件一般不备份，只需备份用户数据，其他的和硬件有关的数据由系统自动生成。

由此原则，我们只需备份 / 分区，但是还需要 boot 分区才能开机，所以需要先安装系统，系统就自动生成了这些文件，然后再把用户数据恢复过来。



# 备份系统



```
rsync -aAXv --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found","/etc/fstab"} /*  /mnt
```



/mnt 目录挂载的是外部机械硬盘，我专门用来存放大量数据的，这里也同样用来存放系统备份数据。





# 恢复系统

假设系统不小心被弄坏了，或者有事换成了其他系统，这时我们想要恢复原来的系统。

先做好 usb 刻录，假设我原来的想恢复到固态硬盘中，那首先直接把系统装到固态硬盘中。

然后重新进入 livecd 系统，livecd 就是安装系统的那个界面，然后把两个硬盘都挂载到目录中。

假设 固态硬盘/即要恢复的硬盘是

   /dev/sda1             挂载到             /mnt/new

   /dev/sdb2             挂载到            /mnt/new/boot

假设 机械硬盘/存备份数据的硬盘是   

  /dev/sdb                 挂载到             /mnt/old



```
rsync -aAXv  /mnt/old/*  /mnt/new --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found","/etc/fstab"}
```





当然，也可以直接进入固态系统，然后挂载机械硬盘，再直接恢复后修复 grub，原理都是一样的。



# 修复 grub



```
grub-install --recheck /dev/sda

grub-mkconfig -o /mnt/new/boot/grub/grub.cfg  
或
grub-mkconfig -o /boot/grub/grub.cfg	
```



# 修复 UUID

如果备份了 /etc/fstab，那么就需要更改，但是这里没有备份，是自动生成的，所以不用修改。 


```
# 查看 uuid
sudo blkid
# 修改 uuid
nano /etc/fstab

```